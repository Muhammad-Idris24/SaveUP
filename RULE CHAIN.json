{
  "ruleChain": {
    "name": "EnergyNode Alert Engine",
    "root": true,
    "debugMode": false
  },
  "metadata": {
    "firstNodeIndex": 0,
    "nodes": [
      {
        "id": "1",
        "type": "org.thingsboard.rule.engine.filter.TbMsgTypeFilterNode",
        "name": "Filter: POST_TELEMETRY",
        "debugMode": false,
        "configuration": {
          "messageTypes": ["POST_TELEMETRY"]
        }
      },
      {
        "id": "2",
        "type": "org.thingsboard.rule.engine.filter.TbJsSwitchNode",
        "name": "Check Voltage > Threshold",
        "debugMode": false,
        "configuration": {
          "jsScript": "var threshold = 260; return msg.voltage > threshold ? 'true' : 'false';"
        }
      },
      {
        "id": "3",
        "type": "org.thingsboard.rule.engine.action.TbCreateAlarmNode",
        "name": "Create OverVoltage Alarm",
        "debugMode": false,
        "configuration": {
          "alarmType": "OverVoltage",
          "severity": "MAJOR",
          "propagate": true,
          "clearAlarm": true,
          "alarmDetails": "{}"
        }
      },
      {
        "id": "4",
        "type": "org.thingsboard.rule.engine.filter.TbJsSwitchNode",
        "name": "Check Current > Threshold",
        "debugMode": false,
        "configuration": {
          "jsScript": "var threshold = 12; return msg.current > threshold ? 'true' : 'false';"
        }
      },
      {
        "id": "5",
        "type": "org.thingsboard.rule.engine.action.TbCreateAlarmNode",
        "name": "Create OverCurrent Alarm",
        "debugMode": false,
        "configuration": {
          "alarmType": "OverCurrent",
          "severity": "MAJOR",
          "propagate": true,
          "clearAlarm": true,
          "alarmDetails": "{}"
        }
      },
      {
        "id": "6",
        "type": "org.thingsboard.rule.engine.filter.TbJsSwitchNode",
        "name": "Check Temperature > Threshold",
        "debugMode": false,
        "configuration": {
          "jsScript": "var threshold = 60; return msg.temperature > threshold ? 'true' : 'false';"
        }
      },
      {
        "id": "7",
        "type": "org.thingsboard.rule.engine.action.TbCreateAlarmNode",
        "name": "Create OverTemperature Alarm",
        "debugMode": false,
        "configuration": {
          "alarmType": "OverTemperature",
          "severity": "CRITICAL",
          "propagate": true,
          "clearAlarm": true,
          "alarmDetails": "{}"
        }
      },
      {
        "id": "8",
        "type": "org.thingsboard.rule.engine.filter.TbJsSwitchNode",
        "name": "Check PF Low",
        "debugMode": false,
        "configuration": {
          "jsScript": "var threshold = 0.70; return msg.pf < threshold ? 'true' : 'false';"
        }
      },
      {
        "id": "9",
        "type": "org.thingsboard.rule.engine.action.TbCreateAlarmNode",
        "name": "Create LowPF Alarm",
        "debugMode": false,
        "configuration": {
          "alarmType": "LowPowerFactor",
          "severity": "MINOR",
          "propagate": true,
          "clearAlarm": true,
          "alarmDetails": "{}"
        }
      },
      {
        "id": "10",
        "type": "org.thingsboard.rule.engine.action.TbLogNode",
        "name": "Debug Logger",
        "debugMode": false,
        "configuration": {
          "logLevel": "INFO",
          "script": "return 'Telemetry processed';"
        }
      },
      {
        "id": "11",
        "type": "org.thingsboard.rule.engine.action.TbMsgGeneratorNode",
        "name": "Notification Trigger",
        "debugMode": false,
        "configuration": {
          "msgTemplate": "{\"alert\": \"${metadata.alarmType}\", \"severity\":\"${metadata.severity}\"}",
          "metadataTemplate": "{}",
          "msgType": "ALARM_NOTIFICATION"
        }
      }
    ],
    "connections": [
      {
        "fromIndex": 0,
        "toIndex": 1,
        "type": "Success"
      },
      {
        "fromIndex": 1,
        "toIndex": 2,
        "type": "Success"
      },
      {
        "fromIndex": 2,
        "toIndex": 3,
        "type": "true"
      },
      {
        "fromIndex": 1,
        "toIndex": 4,
        "type": "Success"
      },
      {
        "fromIndex": 4,
        "toIndex": 5,
        "type": "true"
      },
      {
        "fromIndex": 1,
        "toIndex": 6,
        "type": "Success"
      },
      {
        "fromIndex": 6,
        "toIndex": 7,
        "type": "true"
      },
      {
        "fromIndex": 1,
        "toIndex": 8,
        "type": "Success"
      },
      {
        "fromIndex": 8,
        "toIndex": 9,
        "type": "true"
      },
      {
        "fromIndex": 3,
        "toIndex": 11,
        "type": "Success"
      },
      {
        "fromIndex": 5,
        "toIndex": 11,
        "type": "Success"
      },
      {
        "fromIndex": 7,
        "toIndex": 11,
        "type": "Success"
      },
      {
        "fromIndex": 9,
        "toIndex": 11,
        "type": "Success"
      },
      {
        "fromIndex": 1,
        "toIndex": 10,
        "type": "Success"
      }
    ]
  }
}
